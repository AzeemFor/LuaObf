async function searchScripts() {
    const query = document.getElementById('searchInput').value;
    const results = document.getElementById('results');
    if (!query) return;

    results.innerHTML = "<div class='loading-text'>Searching ScriptBlox...</div>";
    
    try {
        // Updated proxy and endpoint
        const targetUrl = `https://scriptblox-api-proxy.vercel.app/api/search?q=${encodeURIComponent(query)}&mode=free`;
        const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(targetUrl)}`;

        const res = await fetch(proxyUrl);
        
        if (!res.ok) throw new Error(`HTTP Error! Status: ${res.status}`);

        const data = await res.json();
        results.innerHTML = "";

        if (!data.result || !data.result.scripts || data.result.scripts.length === 0) {
            results.innerHTML = "<p style='color:#777;'>No scripts found for that search.</p>";
            return;
        }

        data.result.scripts.forEach(s => {
            const card = document.createElement('div');
            card.className = 'script-card';
            
            // Clean up script string to prevent breaking the button
            const safeScript = s.script.replace(/'/g, "\\'").replace(/"/g, '&quot;');
            
            card.innerHTML = `
                <h3>${s.title}</h3>
                <p style="font-size:11px; color:#777;">Game: ${s.game.name}</p>
                <button class="btn" style="font-size:10px; padding:5px 10px;" onclick="copyText('${safeScript}')">Copy Script</button>
            `;
            results.appendChild(card);
        });
    } catch (e) {
        console.error("Search Error:", e);
        results.innerHTML = `
            <div style="color:#ff4444; font-size:12px; padding:20px;">
                <p>Error: API Connection Failed.</p>
                <p style="color:#777; font-size:10px;">Check console (F12) for details.</p>
            </div>`;
    }
}
